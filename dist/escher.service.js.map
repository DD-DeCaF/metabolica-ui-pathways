{"version":3,"sources":["escher.service.ts"],"names":[],"mappings":"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","file":"escher.service.js","sourcesContent":["/// <reference path=\"../typings/escher.d.ts\"/>\nimport * as escher from 'escher'\n\n// noinspection TypeScriptCheckImport\nimport * as d3 from 'd3';\nimport 'jquery';\n\nconst escherService = angular.module('pathways.escher', []);\n\nexport class EscherService {\n\tdirection: number;\n\tstartCoordinates: any;\n\toptions: any;\n\tmetabolitesNames: any[];\n\treactions: any[];\n\tself: EscherService;\n\n\tconstructor() {\n\t\tthis.direction = -90;\n\t\tthis.startCoordinates = {x: 300, y: 1000};\n\t\tthis.metabolitesNames = [];\n\t\tthis.reactions = [];\n\t\tthis.self = this;\n\t\tthis.options = {\n\t\t\t// just show the zoom buttons\n\t\t\tmenu: 'zoom',\n\t\t\t// do not use the smooth pan and zoom option\n\t\t\tuse_3d_transform: false,\n\t\t\t// no editing in this map\n\t\t\tenable_editing: true,\n\t\t\t// show the descriptive names\n\t\t\tidentifiers_on_map: 'name',\n\t\t\t// hide secondary metabolites\n\t\t\thide_secondary_metabolites: true,\n\t\t\t// don't ask before quiting\n\t\t\tnever_ask_before_quit: true,\n\t\t\t// disable keyboard shortcuts\n\t\t\tenable_keys: false,\n\t\t\tfirst_load_callback: () => {\n\t\t\t\tvar currentThis = eval('this');\n\t\t\t\tfor (var i = this.self.reactions.length - 1; i >= 0; i -= 1) {\n\t\t\t\t\tif (i === this.self.reactions.length - 1) {\n\t\t\t\t\t\tcurrentThis.map.new_reaction_from_scratch(this.self.reactions[i].id, this.self.startCoordinates, this.self.direction);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (var k in currentThis.map.nodes) {\n\t\t\t\t\t\t\tif (currentThis.map.nodes[k].name === this.self.metabolitesNames[i]) {\n\t\t\t\t\t\t\t\tcurrentThis.map.new_reaction_for_metabolite(this.self.reactions[i].id, k, this.self.direction);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var n in currentThis.map.nodes) {\n\t\t\t\t\tcurrentThis.map.nodes[n].node_is_primary = (this.self.metabolitesNames.indexOf(currentThis.map.nodes[n].name) != -1);\n\t\t\t\t}\n\t\t\t\tcurrentThis.map.draw_everything();\n\t\t\t\tcurrentThis.map.zoom_extent_nodes();\n\t\t\t\tcurrentThis.map.select_none();\n\t\t\t}\n\t\t}\n\t};\n\n\talignReactions(data) {\n\t\tvar model = Object.assign({}, data.model);\n\t\tfor (var i in data.primary_nodes) {\n\t\t\tfor (var j in model.reactions) {\n\t\t\t\tif (model.reactions[j].id === data.reactions[i].id) {\n\t\t\t\t\tif (model.reactions[j].metabolites[data.primary_nodes[i].id] > 0) {\n\t\t\t\t\t\tfor (var k in model.reactions[j].metabolites) {\n\t\t\t\t\t\t\tmodel.reactions[j].metabolites[k] *= -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn model;\n\t}\n\n\tbuildMap(data, controller_id) {\n\t\tdata.primary_nodes.forEach(\n\t\t\t(value) => this.metabolitesNames.push(value.name)\n\t\t);\n\t\tthis.reactions = data.reactions;\n\t\tescher.Builder(null, this.alignReactions(data), null, d3.select('#' + controller_id), this.options);\n\t}\n}\n\nescherService.service('EscherService', EscherService);\nexport default escherService;\n"]}